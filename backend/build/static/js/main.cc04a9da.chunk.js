(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{14:function(e,t,n){},15:function(e,t,n){},19:function(e,t,n){"use strict";n.r(t);var o=n(1),c=n.n(o),i=n(7),r=n.n(i),s=(n(14),n(2)),a=(n(15),n(3)),u=1,l=2,d=3,f=4,j=function e(t,n){Object(a.a)(this,e),this.coord=t,this.type=n},b=n(0),h=function(e){var t,n,o=e.token,c=e.type,i=e.onTokenSelected;o&&o.isSelected?(t="token-selected",n=o.selectedBy):t=o&&!o.isSelected?"token":c===l?"tile-exit":c===d?"tile-wall":c===f?"tile-unknown":"tile";return Object(b.jsx)("div",{className:t,onClick:function(){o&&i(o)},children:n})},O=n(8),m="wss://"+window.location.host,p=new WebSocket(m);p.onopen=function(){console.log("Opened!")};var y=[],v=[];p.onerror=function(e){console.log("Sorry, but there's some problem with your connection or the server is down.")},p.onmessage=function(e){try{var t=JSON.parse(e.data)}catch(c){return void console.log("Invalid JSON: ",e.data)}var n,o=Object(O.a)(y);try{for(o.s();!(n=o.n()).done;){n.value.handle(t)}}catch(i){o.e(i)}finally{o.f()}},setInterval((function(){1!==p.readyState&&console.log("Error missing connection")}),3e3);var x=function(e){p.send(e)},S=function(e){x(JSON.stringify({type:e}))},g=function(e){v.includes(e)&&S(e)},k=x,w=function(){g("RIGHT")},N=function(){g("LEFT")},E=function(){g("DOWN")},T=function(){g("UP")},I=function(e){v=e},J=function(){S("RESET")},M=function(e){x(JSON.stringify({type:"DO-SOMETHING",player:e}))},D=function(e){(y=y.filter((function(t){return t.id!==e.id}))).push(e)},B=n(4),C=n.n(B),G=function(e){var t=e.grid,n=e.tokens,o=function(e){k(JSON.stringify({type:"SELECTED",selected:e.id}))};return Object(b.jsx)("div",{className:"game-board",onKeyPress:function(e){"s"===e.key?E():"w"===e.key?T():"a"===e.key?N():"d"===e.key&&w()},tabIndex:0,children:Object(b.jsx)("table",{children:Object(b.jsx)("tbody",{children:t.map((function(e,t){return Object(b.jsx)("tr",{children:e.map((function(e,t){return Object(b.jsx)("td",{children:Object(b.jsx)(h,{type:e.type,token:(c=e.coord,n.find((function(e){return C()(e.coord,c)}))),onTokenSelected:o})},e.coord.toString());var c}))},t)}))})})})},P=n(9),R=function(){function e(t,n){Object(a.a)(this,e),this.x=t,this.y=n}return Object(P.a)(e,[{key:"toString",value:function(){return"(".concat(this.x,", ").concat(this.y,")")}}]),e}(),H=function e(t,n,o,c){Object(a.a)(this,e),this.id=t,this.coord=n,this.isSelected=o,this.selectedBy=c},L=function(e){var t=e.moves,n=e.isSelf,o="Moves:";return Object(b.jsxs)("div",{children:[n?Object(b.jsx)("h2",{children:o}):Object(b.jsx)("h3",{children:o}),Object(b.jsx)("ul",{children:t.map((function(e){return Object(b.jsx)("li",{children:e},e)}))})]})},W=function(e){var t=e.playerName,n=e.allowedMoves,o=e.isSelf,c=e.doSomething;return Object(b.jsxs)("div",{className:o?"player-self":"player-other",children:[Object(b.jsxs)("div",{className:"player-bar",children:[Object(b.jsx)("label",{children:t}),o?"":Object(b.jsx)("button",{onClick:function(e){c(t)},children:"Do Something!"})]}),Object(b.jsx)(L,{moves:n,isSelf:o})]})},Y=function(e){var t=e.notification;return null===t?null:Object(b.jsx)("div",{className:t.isGood?"notification":"notification-bad",children:t.message})},A=function(e){var t=e.remainingSeconds;if(!t)return"";var n=function(e){var t="00"+e;return t.substr(t.length-2)},o=n(Math.floor(t/60)),c=n(t%60),i=t>10?"timer":"timer-critical";return Object(b.jsx)("div",{className:i,children:"".concat(o,":").concat(c)})},F=function(e){var t=parseInt(e.x),n=parseInt(e.y);return new R(t,n)},K=function(e){return e.tokens.map((function(t,n){return new H(n,F(t),e.selectedTokens.some((function(e){return e===n})),function(e,t){var n=e.find((function(e){return e.selection===t}));return n?n.selectedBy.split(" ").map((function(e){return e[0]})).join(""):null}(e.selections,n))}))};var U=function(){var e=Object(o.useState)([[]]),t=Object(s.a)(e,2),n=t[0],c=t[1],i=Object(o.useState)([]),r=Object(s.a)(i,2),a=r[0],h=r[1],O=Object(o.useState)([]),m=Object(s.a)(O,2),p=m[0],y=m[1],v=Object(o.useState)(""),x=Object(s.a)(v,2),S=x[0],g=x[1],k=Object(o.useState)([]),w=Object(s.a)(k,2),N=w[0],E=w[1],T=Object(o.useState)(null),B=Object(s.a)(T,2),P=B[0],H=B[1],L=Object(o.useState)(null),U=Object(s.a)(L,2),q=U[0],z=U[1],Q=function(){H(null)},V=function(e,t,n){H({message:e,isGood:n}),t&&setTimeout((function(){Q()}),5e3)};D({id:"app-updates",handle:function(e){"token-update"===e.type?h(K(e.data)):"board-update"===e.type?(c(function(e){for(var t=[],n=e.board,o=n.exits.map((function(e){return F(e)})),c=n.walls.map((function(e){return F(e)})),i=n.tiles.map((function(e){return F(e)})),r=0;r<n.height;r++){for(var s=[],a=function(e){var t=new R(e,r),n=void 0;n=o.some((function(e){return C()(e,t)}))?l:c.some((function(e){return C()(e,t)}))?d:i.some((function(e){return C()(e,t)}))?u:f,s.push(new j(t,n))},b=0;b<n.width;b++)a(b);t.push(s)}return t}(e.data)),h(K(e.data.tokenData)),Q()):"win"===e.type?V("You have won the game!",!1,!0):"movements"===e.type?(I(e.data.movements),y(e.data.movements)):"name"===e.type?g(e.data.name):"all-players"===e.type?E(e.data.filter((function(e){return e.playerName!==S}))):"do-something"===e.type?V("".concat(e.data.sender," wants you to do something."),!0,!0):"timer-update"===e.type?z(e.data.seconds):"lose"===e.type&&V("You have lost the game..",!1,!1)}});var X=function(e){M(e)};return Object(b.jsxs)("div",{className:"App",children:[Object(b.jsx)(Y,{notification:P}),Object(b.jsxs)("div",{className:"board-space",children:[Object(b.jsxs)("div",{className:"board-controls",children:[Object(b.jsx)(A,{remainingSeconds:q}),Object(b.jsx)("br",{}),Object(b.jsx)(W,{playerName:S,allowedMoves:p,isSelf:!0}),Object(b.jsx)("br",{}),Object(b.jsx)("h2",{hidden:!N.length,children:"Other Players:"}),N.map((function(e){return Object(b.jsx)(W,{playerName:e.playerName,allowedMoves:e.moves,isSelf:!1,doSomething:X},e.playerName)})),Object(b.jsx)("button",{onClick:function(e){J()},children:"Reset"})]}),Object(b.jsx)(G,{grid:n,tokens:a})]})]})};r.a.render(Object(b.jsx)(c.a.StrictMode,{children:Object(b.jsx)(U,{})}),document.getElementById("root"))}},[[19,1,2]]]);
//# sourceMappingURL=main.cc04a9da.chunk.js.map