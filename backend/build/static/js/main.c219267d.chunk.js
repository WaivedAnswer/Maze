(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{14:function(e,t,n){},15:function(e,t,n){},19:function(e,t,n){"use strict";n.r(t);var c=n(1),o=n.n(c),i=n(7),r=n.n(i),a=(n(14),n(2)),s=(n(15),n(3)),l=1,u=2,d=3,j=4,f=function e(t,n){Object(s.a)(this,e),this.coord=t,this.type=n},b=n.p+"static/media/token-none.91062c4c.png",h=n.p+"static/media/token-selected.59573fc5.png",O=n(0),m=function(e){var t,n=e.token,c=e.onTokenSelected;if(!n)return"";n.selectedBy?t=h:n.selectedBy||(t=b);return Object(O.jsx)("div",{className:"token",onClick:function(){n&&(console.log("click"),c(n))},children:Object(O.jsx)("img",{src:t,alt:"token"})})},p=function(e){var t,n=e.token,c=e.type,o=e.onTokenSelected;return t=c===u?"tile-exit":c===d?"tile-wall":c===j?"tile-unknown":"tile",Object(O.jsx)("div",{className:t,children:Object(O.jsx)(m,{token:n,onTokenSelected:o})})},v=n(8),y="wss://"+window.location.host,x=new WebSocket(y);x.onopen=function(){console.log("Opened!")};var S=[],g=[];x.onerror=function(e){console.log("Sorry, but there's some problem with your connection or the server is down.")},x.onmessage=function(e){try{var t=JSON.parse(e.data)}catch(o){return void console.log("Invalid JSON: ",e.data)}var n,c=Object(v.a)(S);try{for(c.s();!(n=c.n()).done;){n.value.handle(t)}}catch(i){c.e(i)}finally{c.f()}},setInterval((function(){1!==x.readyState&&console.log("Error missing connection")}),3e3);var k=function(e){x.send(e)},w=function(e){k(JSON.stringify({type:e}))},N=function(e){g.includes(e)&&w(e)},T=k,E=function(){N("RIGHT")},I=function(){N("LEFT")},J=function(){N("DOWN")},M=function(){N("UP")},B=function(e){g=e},D=function(){w("RESET")},C=function(e){k(JSON.stringify({type:"DO-SOMETHING",player:e}))},G=function(e){(S=S.filter((function(t){return t.id!==e.id}))).push(e)},P=n(4),R=n.n(P),H=function(e){var t=e.grid,n=e.tokens,c=function(e){T(JSON.stringify({type:"SELECTED",selected:e.id}))};return Object(O.jsx)("div",{className:"game-board",onKeyPress:function(e){"s"===e.key?J():"w"===e.key?M():"a"===e.key?I():"d"===e.key&&E()},tabIndex:0,children:Object(O.jsx)("table",{children:Object(O.jsx)("tbody",{children:t.map((function(e,t){return Object(O.jsx)("tr",{children:e.map((function(e,t){return Object(O.jsx)("td",{children:Object(O.jsx)(p,{type:e.type,token:(o=e.coord,n.find((function(e){return R()(e.coord,o)}))),onTokenSelected:c})},e.coord.toString());var o}))},t)}))})})})},L=n(9),W=function(){function e(t,n){Object(s.a)(this,e),this.x=t,this.y=n}return Object(L.a)(e,[{key:"toString",value:function(){return"(".concat(this.x,", ").concat(this.y,")")}}]),e}(),Y=function e(t,n,c){Object(s.a)(this,e),this.id=t,this.coord=n,this.selectedBy=c},A=function(e){var t=e.moves,n=e.isSelf,c="Moves:";return Object(O.jsxs)("div",{children:[n?Object(O.jsx)("h2",{children:c}):Object(O.jsx)("h3",{children:c}),Object(O.jsx)("ul",{children:t.map((function(e){return Object(O.jsx)("li",{children:e},e)}))})]})},F=function(e){var t=e.playerName,n=e.allowedMoves,c=e.isSelf,o=e.doSomething;return Object(O.jsxs)("div",{className:c?"player-self":"player-other",children:[Object(O.jsxs)("div",{className:"player-bar",children:[Object(O.jsx)("label",{children:t}),c?"":Object(O.jsx)("button",{onClick:function(e){o(t)},children:"Do Something!"})]}),Object(O.jsx)(A,{moves:n,isSelf:c})]})},K=function(e){var t=e.notification;return null===t?null:Object(O.jsx)("div",{className:t.isGood?"notification":"notification-bad",children:t.message})},U=function(e){var t=e.remainingSeconds;if(!t)return"";var n=function(e){var t="00"+e;return t.substr(t.length-2)},c=n(Math.floor(t/60)),o=n(t%60),i=t>10?"timer":"timer-critical";return Object(O.jsx)("div",{className:i,children:"".concat(c,":").concat(o)})},q=function(e){var t=parseInt(e.x),n=parseInt(e.y);return new W(t,n)},z=function(e){return e.tokens.map((function(t,n){return new Y(n,q(t),function(e,t){var n=e.find((function(e){return e.selection===t}));return n?n.selectedBy.split(" ").map((function(e){return e[0]})).join(""):null}(e.selections,n))}))};var Q=function(){var e=Object(c.useState)([[]]),t=Object(a.a)(e,2),n=t[0],o=t[1],i=Object(c.useState)([]),r=Object(a.a)(i,2),s=r[0],b=r[1],h=Object(c.useState)([]),m=Object(a.a)(h,2),p=m[0],v=m[1],y=Object(c.useState)(""),x=Object(a.a)(y,2),S=x[0],g=x[1],k=Object(c.useState)([]),w=Object(a.a)(k,2),N=w[0],T=w[1],E=Object(c.useState)(null),I=Object(a.a)(E,2),J=I[0],M=I[1],P=Object(c.useState)(null),L=Object(a.a)(P,2),Y=L[0],A=L[1],Q=function(){M(null)},V=function(e,t,n){M({message:e,isGood:n}),t&&setTimeout((function(){Q()}),5e3)};G({id:"app-updates",handle:function(e){"token-update"===e.type?b(z(e.data)):"board-update"===e.type?(o(function(e){for(var t=[],n=e.board,c=n.exits.map((function(e){return q(e)})),o=n.walls.map((function(e){return q(e)})),i=n.tiles.map((function(e){return q(e)})),r=0;r<n.height;r++){for(var a=[],s=function(e){var t=new W(e,r),n=void 0;n=c.some((function(e){return R()(e,t)}))?u:o.some((function(e){return R()(e,t)}))?d:i.some((function(e){return R()(e,t)}))?l:j,a.push(new f(t,n))},b=0;b<n.width;b++)s(b);t.push(a)}return t}(e.data)),b(z(e.data.tokenData)),Q()):"win"===e.type?V("You have won the game!",!1,!0):"movements"===e.type?(B(e.data.movements),v(e.data.movements)):"name"===e.type?g(e.data.name):"all-players"===e.type?T(e.data.filter((function(e){return e.playerName!==S}))):"do-something"===e.type?V("".concat(e.data.sender," wants you to do something."),!0,!0):"timer-update"===e.type?A(e.data.seconds):"lose"===e.type&&V("You have lost the game..",!1,!1)}});var X=function(e){C(e)};return Object(O.jsxs)("div",{className:"App",children:[Object(O.jsx)(K,{notification:J}),Object(O.jsxs)("div",{className:"board-space",children:[Object(O.jsxs)("div",{className:"board-controls",children:[Object(O.jsx)(U,{remainingSeconds:Y}),Object(O.jsx)("br",{}),Object(O.jsx)(F,{playerName:S,allowedMoves:p,isSelf:!0}),Object(O.jsx)("br",{}),Object(O.jsx)("h2",{hidden:!N.length,children:"Other Players:"}),N.map((function(e){return Object(O.jsx)(F,{playerName:e.playerName,allowedMoves:e.moves,isSelf:!1,doSomething:X},e.playerName)})),Object(O.jsx)("button",{onClick:function(e){D()},children:"Reset"})]}),Object(O.jsx)(H,{grid:n,tokens:s})]})]})};r.a.render(Object(O.jsx)(o.a.StrictMode,{children:Object(O.jsx)(Q,{})}),document.getElementById("root"))}},[[19,1,2]]]);
//# sourceMappingURL=main.c219267d.chunk.js.map